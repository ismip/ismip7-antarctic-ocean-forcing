## the working directory
[workdir]
# base working directory
base_dir = .


## config options related to the default ISMIP grid
[ismip_grid]
# the grid resolution in meters
dx = 8000.0
dy = 8000.0
dz = 60.0

# vertical resolution in meters used for extrapolating ocean forcing fields
dz_extrap = 20.0

## config options related to remapping
[remap]

# tool for generating weight (mapping) files: 'esmf' or 'moab'
tool = esmf

# the path to the system ESMF, containing bin/ESMF_RegridWeightGen
# (if not using conda-forge)
esmf_path = None

# the path to the system MOAB, containing bin/mbtempest
# (if not using conda-forge)
moab_path = None

# the parallel executable (mpirun or srun)
parallel_exec = mpirun

# the number of cores to use for remapping
cores = 64

# remapping method ('bilinear', 'neareststod', 'conserve')
method = bilinear

# threshold for renormalization during horizontal remapping
threshold = 1e-3


## config options related to vertical interpolation
[vert_interp]

# threshold for renormalization
threshold = 1e-3


## Config options related to CMIP datasets
[cmip_dataset]

# lat and lon variable names and dimensions
lat_var = lat
lon_var = lon
lat_dim = lat
lon_dim = lon

## split CMIP datasets into multiple files
[split_cmip]

# the number of months per output file
months_per_file = 120


## Config options related to conversion of CMIP datasets (thetao/so -> ct/sa)
[convert_cmip]

# depth coordinate variable name
depth_var = lev

# time chunk for conversion
time_chunk = 12


## Config options related to vertical and horizontal remapping of CMIP datasets
[remap_cmip]

# size of xarray chunks in time for vertical interpolation
vert_time_chunk = 1

# size of xarray chunks in time for horizontal remapping
horiz_time_chunk = 120


## Config options related to extrapolation of remapped CMIP datasets
[extrap_cmip]

# size of time chunks (months) to process per Fortran run
time_chunk = 12

# size of time chunks (months) for resampling
time_chunk_resample = 12

# number of parallel workers (processes) for time chunks; use 'auto' to leave
# one core free for dispatch on the current machine
num_workers = 1


## config options related to extrapolation
[extrap]

# mask out ice-covered regions before extrapolation?
mask_under_ice = True

# threshold for under-ice masking: mask where ice_frac > under_ice_threshold
under_ice_threshold = 1e-3


## config options related to the present-day topography dataset
[topo]
# the topography dataset
dataset = bedmap3

# remapping method: 'conserve' or 'bilinear'
remap_method = conserve

# threshold for renormalization after remapping
renorm_threshold = 1e-3


## config options related to IMBIE basin masks
[imbie]

# isobath depth (positive meters) defining the outer boundary of the
# continental shelf used when extending basins into the ocean
shelf_isobath_depth = 1500.0

# ocean fraction threshold for defining ocean cells when extending basins
frac_threshold = 0.5

# number of iterations for dilation when extending basin masks
seed_dilation_iters = 10

# write debugging output when extending basin masks?
debug = False

## config options related to downloading
[download]
# whether to suppress a progress bar
quiet = False


## config options related to bias correction
[biascorr]

# size of time chunks (months)
time_chunk = 12


## config options related to converting CT/SA to thermal forcing (TF)
[ct_sa_to_tf]

# time chunk for processing (months)
time_chunk = 12

# use polynomial approximation for CT_freezing for speed (tiny error)
use_poly = True

# freezing temperature parameters from Jourdain et al. (2017, JGR)
lbd1 = -0.0564
lbd2 = 0.0773
lbd3 = -7.8633e-8


## Config options for converting annual CT/SA back to thetao/so
[ct_sa_to_thetao_so]

# years per processing chunk when converting annual means
time_chunk_years = 10
